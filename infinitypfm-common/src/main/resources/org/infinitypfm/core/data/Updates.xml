<?xml version="1.0" encoding="UTF-8" ?>
<!--

Copyright (c) 2005-2021 Wayne Gray All rights reserved
  
 This file is part of Infinity PFM.
  
 Infinity PFM is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.
  
 Infinity PFM is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.
  
 You should have received a copy of the GNU General Public License
 along with Infinity PFM.  If not, see <http://www.gnu.org/licenses/>.

-->


<!DOCTYPE mapper 
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Updates">

   <insert id="v0_0_2_a">
	   CREATE CACHED TABLE AppSettings
	(
	  AppVersion   VARCHAR(15)
	); 

   </insert>

   <insert id="v0_0_2_b">
 	INSERT INTO AppSettings (AppVersion)
 	VALUES ('0.0.2');
   </insert>
   
   <insert id="v0_0_2_c">
 	INSERT INTO AccountTypes (ACTTYPENAME)
	VALUES ('Liability')
   </insert>
   
   <update id="bumpVersion" parameterType="java.lang.String">
 	UPDATE AppSettings
 	 SET AppVersion= #{value}
   </update>
   
   <insert id="v0_3_0_a">
   CREATE CACHED TABLE RecurHeader
	(
	  RecurID 	   INT GENERATED BY DEFAULT AS IDENTITY (START WITH 0),
	  Memo   VARCHAR(255),
	  ActID		INT,
	  OffsetID		INT,
	  NextRunDate	       DATETIME,
	  Amount       DECIMAL(15,4),
	  FrequencyID INT
	);
   </insert>
   
   <insert id="v0_3_0_b">
   CREATE CACHED TABLE RecurDetail
	(
	  RecurTranID 	   INT GENERATED BY DEFAULT AS IDENTITY (START WITH 0),
	  RecurID 	   INT,
	  TranDate	       DATETIME
	);
   </insert>
   
   <insert id="v0_3_0_c">
   ALTER TABLE  RecurHeader ADD
    CONSTRAINT RecurHeader_RecurID
    UNIQUE (RecurID);
   </insert>
   
   <insert id="v0_3_0_d">
   ALTER TABLE  RecurDetail ADD
    CONSTRAINT RecurDetail_RecurTranID
    UNIQUE (RecurTranID);
   </insert>
   
   <insert id="v0_3_0_e">
  ALTER TABLE RecurDetail ADD 
	CONSTRAINT FK_RecurDetail_RecurHeader 
	 FOREIGN KEY (RecurID) REFERENCES RecurHeader (RecurID);
   </insert>
         
   <update id="v0_5_0_b">
 	ALTER TABLE AppSettings ADD COLUMN DefaultCurrencyID INT DEFAULT 0;
   </update>
   <update id="v0_5_0_e">
   		ALTER TABLE ACCOUNTS ADD COLUMN ACTBALANCE2 BIGINT DEFAULT 0;
   </update>
   <update id="v0_5_0_f">
   		UPDATE ACCOUNTS SET ACTBALANCE2 = convert(actbalance *100, bigint);
   </update>
   <update id="v0_5_0_g">
   		ALTER TABLE ACCOUNTS DROP COLUMN ACTBALANCE;
   </update>
   <update id="v0_5_0_h">
		ALTER TABLE ACCOUNTS ALTER COLUMN ACTBALANCE2 RENAME TO ACTBALANCE;
   </update>
   <update id="v0_5_0_i">
   		ALTER TABLE BUDGETDETAIL ADD COLUMN AMOUNT2 BIGINT DEFAULT 0;
   </update>
   <update id="v0_5_0_j">
   		UPDATE BUDGETDETAIL SET AMOUNT2 = convert(AMOUNT *100, bigint);
   </update>
   <update id="v0_5_0_k">
   		ALTER TABLE BUDGETDETAIL DROP COLUMN AMOUNT;
   </update>
   <update id="v0_5_0_l">
   		ALTER TABLE BUDGETDETAIL ALTER COLUMN AMOUNT2 RENAME TO AMOUNT;
   </update>
   <update id="v0_5_0_m">
   		ALTER TABLE MONTHLYBALANCE ADD COLUMN ACTBALANCE2 BIGINT DEFAULT 0;
   </update>
   <update id="v0_5_0_n">
   		UPDATE MONTHLYBALANCE SET ACTBALANCE2 = convert(ACTBALANCE *100, bigint);
   </update>
   <update id="v0_5_0_o">
   		ALTER TABLE MONTHLYBALANCE DROP COLUMN ACTBALANCE;
   </update>
   <update id="v0_5_0_p">
   		ALTER TABLE MONTHLYBALANCE ALTER COLUMN ACTBALANCE2 RENAME TO ACTBALANCE;
   </update>
   <update id="v0_5_0_q">
   		ALTER TABLE RECURHEADER ADD COLUMN AMOUNT2 BIGINT DEFAULT 0;
   </update>
   <update id="v0_5_0_r">
   		UPDATE RECURHEADER SET AMOUNT2 = convert(AMOUNT *100, bigint);
   </update>
   <update id="v0_5_0_s">
   		ALTER TABLE RECURHEADER DROP COLUMN AMOUNT;
   </update>
   <update id="v0_5_0_t">
   		ALTER TABLE RECURHEADER ALTER COLUMN AMOUNT2 RENAME TO AMOUNT;
   </update>
   <update id="v0_5_0_u">
   		ALTER TABLE TRANSACTIONS ADD COLUMN TRANAMOUNT2 BIGINT DEFAULT 0;
   </update>
   <update id="v0_5_0_v">
   		UPDATE TRANSACTIONS SET TRANAMOUNT2 = convert(TRANAMOUNT *100, bigint);
   </update>
   <update id="v0_5_0_w">
   		ALTER TABLE TRANSACTIONS DROP COLUMN TRANAMOUNT;
   </update>
   <update id="v0_5_0_x">
   		ALTER TABLE TRANSACTIONS ALTER COLUMN TRANAMOUNT2 RENAME TO TRANAMOUNT;
   </update>
    <update id="v0_5_0_y">
   		ALTER TABLE ACCOUNTS ADD COLUMN CURRENCYID INT DEFAULT NULL;
   </update>
   <update id="v0_5_0_z">
   		UPDATE ACCOUNTS SET CURRENCYID = 0;
   </update>
   <update id="v0_5_0_za">
   		ALTER TABLE TRANSACTIONS ADD COLUMN TranKey VARCHAR(255) NULL;
   </update>

   <update id="v0_6_0_a">
 		ALTER TABLE AppSettings ADD COLUMN CurrencyPrecision INT DEFAULT 2;
   </update>
   <update id="v0_6_0_b">
   		UPDATE TRANSACTIONS SET TRANAMOUNT = TRANAMOUNT * 1000000;
   </update>
   <update id="v0_6_0_c">
   		UPDATE ACCOUNTS SET ACTBALANCE = ACTBALANCE * 1000000;
   </update>
   <update id="v0_6_0_d">
   		UPDATE BUDGETDETAIL SET AMOUNT = AMOUNT * 1000000;
   </update>
   <update id="v0_6_0_e">
   		UPDATE MONTHLYBALANCE SET ACTBALANCE = ACTBALANCE * 1000000;
   </update> 
   <update id="v0_6_0_f">
   		UPDATE RECURHEADER SET AMOUNT = AMOUNT * 1000000;
   </update>
   <update id="v0_6_0_g">
   		UPDATE TRADES SET AMOUNT = AMOUNT * 1000000;
   </update>
   <delete id="v0_6_0_h">
   		DELETE FROM CURRENCYMETHODS; 
   </delete>
   <update id="v0_6_0_i">
   		ALTER TABLE CURRENCYMETHODS DROP COLUMN METHODCLASS;
   </update>
   <update id="v0_6_0_j">
   		ALTER TABLE CURRENCYMETHODS ADD COLUMN MethodUrl VARCHAR(500);
   </update>
   <update id="v0_6_0_k">
   		ALTER TABLE CURRENCYMETHODS ADD COLUMN MethodPath VARCHAR(500);
   </update>
   <update id="v0_7_0_a">
   		ALTER TABLE APPSETTINGS ADD COLUMN ReportsInBrowswer INT;
   </update>
   <update id="v0_7_0_b">
   		UPDATE APPSETTINGS SET ReportsInBrowswer = 0;
   </update>
   <delete id="v0_7_0_c">
   		DELETE FROM CURRENCYMETHODS WHERE METHODNAME = 'mtgox.com';
   </delete>
   <insert id="v0_7_0_d">
   		INSERT INTO CURRENCYMETHODS (CURRENCYID, METHODNAME, METHODURL, METHODPATH)
   		VALUES (1, 'Coinbase', 'http://api.coinbase.com/v2/prices/BTC-USD/spot', '$$.data.amount');
   </insert>
   <insert id="v0_7_0_e">
   		INSERT INTO CURRENCYMETHODS (CURRENCYID, METHODNAME, METHODURL, METHODPATH)
   		VALUES (1, 'Bitstamp', 'https://www.bitstamp.net/api/ticker/', '$$.last');
   </insert>
   <update id="v0_7_0_f">
   		ALTER TABLE APPSETTINGS ADD COLUMN ConsoleDefaultOpen INT;
   </update>
   <update id="v0_7_0_g">
   		UPDATE APPSETTINGS SET ConsoleDefaultOpen = 0;
   </update>
   <update id="v0_7_7_a">
   		ALTER TABLE Transactions ALTER COLUMN TranMemo VARCHAR(500);
   </update>
   <update id="v0_7_7_b">
   		ALTER TABLE ImportHistory ALTER COLUMN Memo VARCHAR(500);
   </update>
   <update id="v0_7_7_c">
   		ALTER TABLE RecurHeader ALTER COLUMN Memo VARCHAR(500);
   </update>
   <update id="v0_9_0_a">
   		ALTER TABLE AppSettings ADD COLUMN WalletEnabled INT;
   </update>
    <update id="v0_9_0_b">
   		UPDATE AppSettings SET WalletEnabled=0;
   </update>
   <update id="v0_9_0_c">
   		ALTER TABLE AppSettings ADD COLUMN SpendPassword VARCHAR(100);
   </update>
   <update id="v0_9_0_d">
   		ALTER TABLE AppSettings ADD COLUMN DefaultBsvCurrencyMethod VARCHAR(50);
   </update>
   <update id="v0_9_0_e">
 	ALTER TABLE AppSettings ADD COLUMN DefaultBsvCurrencyID INT DEFAULT 0;
   </update>
   <update id="v0_9_0_f">
 	ALTER TABLE Currencies ADD COLUMN CurrencyPrecision INT DEFAULT 2;
   </update>
   <update id="v0_9_5_a">
 	ALTER TABLE AppSettings ADD COLUMN EmailAddress VARCHAR(50);
   </update>
   <update id="v0_9_5_b">
 	ALTER TABLE AppSettings ADD COLUMN WalletUser VARCHAR(50);
   </update>
   <update id="v0_9_5_c">
 	ALTER TABLE AppSettings ADD COLUMN WalletToken VARCHAR(500);
   </update>
   <update id="v0_9_5_d">
 	ALTER TABLE AppSettings ADD COLUMN BookmarksUrl VARCHAR(500);
   </update>
   <update id="v0_9_5_e">
 	ALTER TABLE AppSettings ADD COLUMN WalletId VARCHAR(50);
   </update>
      <update id="v0_9_5_f">
 	UPDATE AppSettings SET BookmarksUrl = 'https://www.infinitypfm.org/gettingstarted';
   </update>
   <update id="v0_9_5_g">
 	ALTER TABLE AppSettings ADD COLUMN ReportPath VARCHAR(500);
   </update>
      <update id="v0_9_5_h">
 	UPDATE AppSettings SET ReportPath = '/tmp';
   </update>
</mapper>
